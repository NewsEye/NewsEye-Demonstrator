<div id="article_links" class="panel panel-default">
  <div class="panel-body">
    <%= link_to "Original Issue", "#{url_for(controller: 'catalog')}/#{@document[:from_issue_ssi]}", :id=>"originalIssueLink" %>
    <%#= link_to "manifest", "#{url_for(controller: 'iiif', action: 'manifest', id: @document[:from_issue_ssi], locale: nil)}" %>
  </div>
</div>

<div id="manage_tools" class="panel panel-default">
  <div class="panel-body">
    <%= render 'add_article_to_dataset_dropdown' %>
  </div>
</div>

<% named_entities = get_named_entities_for_article(@document.id) %>
<div id="named_entities_persons_list" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title"><a data-toggle="collapse" href="#collapse1">
      Persons
      <span style="color: grey">
        (<%= named_entities[:PER].keys.size %> entities,
        <%= named_entities[:PER].keys.map{ |nel| named_entities[:PER][nel].size }.reduce(:+) %> mentions)
      </span>
    </a></h4>
  </div>
  <div id="collapse1" class="panel-collapse collapse">
    <ul class="list-group">
      <% named_entities[:PER].keys.each do |label| %>
        <li class="list-group-item"><a data-toggle="collapse" href="#collapse1b"><%= label %></a></li>
        <div id="collapse1b" class="panel-collapse collapse">
          <ul class="list-group">
            <% named_entities[:PER][label].each do |ne| %>
              <li class="list-group-item ne_mention">
                <%= ne['mention_ssi'] %>
                <p style="display: none;">
                  <%= get_bbox_from_annotations ne['selector_ssim'] %>
                </p>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </ul>
  </div>
</div>
<div id="named_entities_locations_list" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title"><a data-toggle="collapse" href="#collapse2">
      Locations
      <span style="color: grey">
        (<%= named_entities[:LOC].keys.size %> entities,
        <%= named_entities[:LOC].keys.map{ |nel| named_entities[:LOC][nel].size }.reduce(:+) %> mentions)
      </span>
    </a></h4>
  </div>
  <div id="collapse2" class="panel-collapse collapse">
    <ul class="list-group">
      <% named_entities[:LOC].keys.each do |label| %>
        <li class="list-group-item"><a data-toggle="collapse" href="#collapse2b"><%= label %></a></li>
        <div id="collapse2b" class="panel-collapse collapse">
          <ul class="list-group">
            <% named_entities[:LOC][label].each do |ne| %>
              <li class="list-group-item ne_mention"><%= ne['mention_ssi'] %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </ul>
  </div>
</div>
<div id="named_entities_organizations_list" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title"><a data-toggle="collapse" href="#collapse3">
      Organizations
      <span style="color: grey">
        (<%= named_entities[:ORG].keys.size %> entities,
        <%= named_entities[:ORG].keys.map{ |nel| named_entities[:ORG][nel].size }.reduce(:+) %> mentions)
      </span>
    </a></h4>
  </div>
  <div id="collapse3" class="panel-collapse collapse">
    <ul class="list-group">
      <% named_entities[:ORG].keys.each do |label| %>
        <li class="list-group-item"><a data-toggle="collapse" href="#collapse3b"><%= label %></a></li>
        <div id="collapse3b" class="panel-collapse collapse">
          <ul class="list-group">
            <% named_entities[:ORG][label].each do |ne| %>
              <li class="list-group-item ne_mention"><%= ne['mention_ssi'] %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </ul>
  </div>
</div>
